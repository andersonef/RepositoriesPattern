{"name":"Repository Pattern implementation for Laravel 5 Projects","tagline":"Implement the Repository Pattern, a Service Layer and Criterias in your Laravel 5 project with just one line of code!","body":"## Repositories Pattern on Laravel 5.1 or superior\r\n\r\nThis package allows you to implement the Repositories design pattern in your laravel application. It makes easy to use a service layer too.\r\n\r\n##Instalation\r\nIts simply to install, just run:\r\n\r\n\tcomposer require andersonef/repositories-pattern\r\n\t\r\n\r\n##Service Provider\r\nYou must register this package service provider at you **config/app.php** file. Just add this line at your $providers array:\r\n\r\n```php\r\nAndersonef\\Repositories\\Providers\\RepositoryProvider::class,\r\n```\r\n\r\n##Creating your Repositories and Services:\r\nAt your console, enter the following command:\r\n\r\n\tphp artisan make:repository BlogNamespace/Post --entity=Models/Post\r\n\t\r\nThis will create the following file structure in your app directory:\r\n\r\napp/ \r\n\r\n\tRepositories/\r\n\t\r\n\t\tBlogNamespace/\r\n\t\t\r\n\t\t\tPostRepository.php\r\n\t\t\t\r\n\tServices/\r\n\t\r\n\t\tBlogNamespace/\r\n\t\t\r\n\t\t\tPostService.php\r\n\r\n\r\n##Repository file structure\r\nYour repository file will be created with the following code:\r\n\t \r\n```php\r\nnamespace Inet\\Repositories\\BlogNamespace;\r\n\r\nuse Andersonef\\Repositories\\Abstracts\\RepositoryAbstract;\r\nuse \\Post;\r\n\r\n/**\r\n* Data repository to work with entity Post.\r\n*\r\n* Class PostRepository\r\n* @package Inet\\Repositories\\BlogNamespace\r\n*/\r\nclass PostRepository extends RepositoryAbstract{\r\n\r\n\r\npublic function entity()\r\n{\r\n    return \\Post::class;\r\n}\r\n\r\n}\r\n```\r\n\r\n##Service file structure\r\nAnd your PostService.php file wil be created with the following code:\r\n\r\n```php\r\nnamespace Inet\\Services\\BlogNamespace;\r\n\r\nuse Andersonef\\Repositories\\Abstracts\\ServiceAbstract;\r\nuse Illuminate\\Database\\DatabaseManager;\r\nuse \\Inet\\Repositories\\BlogNamespace\\PostRepository;\r\n\r\n/**\r\n* Service layer that will applies all application rules to work with Post class.\r\n*\r\n* Class PostService\r\n* @package Inet\\Services\\BlogNamespace\r\n*/\r\nclass PostService extends ServiceAbstract{\r\n\r\n  /**\r\n   * This constructor will receive by dependency injection a instance of PostRepository and DatabaseManager.\r\n   *\r\n   * @param PostRepository $repository\r\n   * @param DatabaseManager $db\r\n   */\r\n  public function __construct(PostRepository $repository, DatabaseManager $db)\r\n  {\r\n      parent::__construct($repository, $db);\r\n  }\r\n}\r\n```\r\n\r\n##Usage\r\nUsing this pattern you wil be able to separate your application rules from your data access rules and you will be able to reuse your code in a very simple way.\r\nImagine that you have an app that users can register using the public pages AND the admin register users using the admin panel. The rules to register an user are the same on both cases, but the admin panel must require an admin logged user AND has an option to isent the new user to pay his subscription value.\r\nIn the old way you would have to replicate the code or use a laravel command to isolate the user registration rules.\r\nUsing the service layer and the repository pattern you will write the user registration rules inside the UserService and on both controllers (public page registration and admin panel) you would call the $userService->create($request->all()).\r\nIf you must implement an api to save users from an android interface, you can reuse your service layer and just change the way your controller respond to the client.\r\n\r\n##Repository Inherited Methods:\r\nYour repository have some inherited methods from RepositoryAbstract class. They are:\r\n - **create(array $data);**: Tries to create a new instance of your specified entity. **WARNING: Your entity must declare the $fillable field**\r\n - **update(array $data, $id);**: Update specified entity.\r\n - **delete($id);**: Delete the specified entity\r\n - **find($id, array $columns = ['*']);**: Find an instance of specified entity by id\r\n - **findBy(array $fields, array $columns = ['*']);**: Find a collection of specified instances using the fields (see phpdocs).\r\n \r\n ##Service Inherited Methods:\r\n Your service will be similar to your repository. The main difference is that your service layer must implement application logic, so it have transaction in its methods:\r\n  - **create(array $data)**: Open a transaction and try to create an instance using the $data array. You can override it\r\n  - **update(array $data, $id)**: Open a transaction and try to update the instance using $data array.\r\n  - **delete($id)**: OPen a transaction and try to delete an instance of specified entity.\r\n  \r\n  ##Magic Methods:\r\n  For convenience, we can use magic methods on both service and repository classes: \r\n  \r\n```php\r\n$yourservice->repositoryMethod(); // this will be the same as: $yourservice->getRepository()->repositoryMethod();\r\n$yourRepository->entityMethod(); // this will be the same as: $tyourRepository->getEntity()->entityMethod();\r\n```\r\n  \r\n  ##Using Criterias:\r\n  You can implement criteria to reuse your application query rules. This package brings you one default criteria, the **FindUsingLikeCriteria**.\r\n  Lets think you must implement a search field on your blog, and must bring all your posts that have some text like $query variable.\r\n  You can simply do:\r\n  \r\n```php\r\n$result = $postService->findByCriteria(new FindUsingLikeCriteria($request->get('textQuery')))->paginate(10);\r\n```\r\n  \r\n  This will returns to you a collection of posts that has title, or content, or author like the text inside 'textQuery' request attribute.\r\n  You can create your own criterias, its really simple to do it:\r\n  ##Creating your own criteria\r\n  This wil be your custom criteria:\r\n  \r\n```php \r\nnamespace Andersonef\\Repositories\\Criteria;\r\n\r\nuse Andersonef\\Repositories\\Abstracts\\CriteriaAbstract;\r\nuse Andersonef\\Repositories\\Contracts\\RepositoryContract;\r\nuse Illuminate\\Database\\Eloquent\\Model;\r\n\r\nclass UnreadRecentPostsCriteria extends CriteriaAbstract{\r\n\r\npublic function apply(Model $model, RepositoryContract $repository)\r\n{\r\n    $model\r\n    ->where('created_at','>',(new \\DateTime())->sub(new \\DateInterval('P3D'))->format('Y-m-d'))\r\n    ->where('status_read', '=', 1);\r\n    return $model;\r\n}\r\n}\r\n```\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}